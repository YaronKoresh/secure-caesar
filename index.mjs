function W(){this.i=0,this.j=0,this.S=new Array}function gt(t){for(var r,e,n=0;n<256;++n)this.S[n]=n;for(n=r=0;n<256;++n)r=r+this.S[n]+t[n%t.length]&255,e=this.S[n],this.S[n]=this.S[r],this.S[r]=e;this.i=0,this.j=0}function mt(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]}function St(){return new W}W.prototype.init=gt,W.prototype.next=mt;var Z,k,j,q,Q=256;function yt(t){k[j++]^=255&t,k[j++]^=t>>8&255,k[j++]^=t>>16&255,k[j++]^=t>>24&255,Q<=j&&(j-=Q)}function nt(){yt((new Date).getTime())}if(null==k){for(k=new Array,j=0;j<Q;)q=Math.floor(65536*Math.random()),k[j++]=q>>>8,k[j++]=255&q;j=0,nt()}function wt(){if(null==Z){for(nt(),(Z=St()).init(k),j=0;j<k.length;++j)k[j]=0;j=0}return Z.next()}function bt(t){for(var r=0;r<t.length;++r)t[r]=wt()}function X(){}X.prototype.nextBytes=bt;var rt=function(t){let r=[],e=0;for(t=encodeURI(t??"");e<t.length;){var n=t.charCodeAt(e++);37==n?(r.push(parseInt(t.substr(e,2),16)),e+=2):r.push(n)}return r},ot=function(t){let r=[],e=0;for(;e<t.length;){var n=t[e];n<128?(r.push(String.fromCharCode(n)),e++):191<n&&n<224?(r.push(String.fromCharCode((31&n)<<6|63&t[e+1])),e+=2):(r.push(String.fromCharCode((15&n)<<12|(63&t[e+1])<<6|63&t[e+2])),e+=3)}return r.join("")},T=function(t,r){for(t=t.toString();t.length<r;)t="0"+t;return t},H=function(t,r){t=t.toString();for(var e=[],n=0;n<t.length;n+=r)e.push(t.substring(n,n+r));return e},K=function(h,a,t,r="="){1==t?t="EncodeString":0==t?t="DecodeString":11==t?t="EncodeNumber":10==t&&(t="DecodeNumber"),"string"==typeof h?h=h.split(""):"number"==typeof h&&(h=[h]);for(var e=0;e<h.length;e++)"number"==typeof h[e]&&(h[e]=String.fromCharCode(h[e]));h=h.join("");var n=[],l=(a="object"!=typeof a?a.toString().split(""):a).length;if(l<2)return"";for(var o=Math.floor(Math.log2(l)),i=null,s=8;s%o!=0;)i=(s+=8)/o;if("encodenumber"==t.toLowerCase()){let t=function(){return Math.pow(l,n)},r=h,e=[],n=0,o=t(),i=0;for(;o<=r;)e.push(0),n++,o=t();let s=n-1;for(;0<=s;){for(var f=Math.pow(l,s);i+f<=r;)e[s]++,i+=f;s--}return e.map(function(t){return a[t]}).reverse().join("")}if("decodenumber"==t.toLowerCase()){let e=0;return h.split("").reverse().map(function(t,r){e+=a.indexOf(t)*Math.pow(l,r)}),e}if("encodestring"==t.toLowerCase()){for(var u="",p=rt(h),c="",g=0;g<p.length;g++)c+=T(p[g].toString(2),8);c.length%o!=0&&(c+="0".repeat(o-c.length%o));for(var w=H(c,o),g=0;g<w.length;g++)u+=a[parseInt(w[g],2)];return null!=i&&(u+=r.repeat((i-u.length%i)%i)),u}if("decodestring"==t.toLowerCase()){for(var m=h.split(""),u="",S="",g=0;g<m.length&&m[g]!=r;g++){var y=m[g],y=a.indexOf(y);if(-1==y)return!1;S+=T(y.toString(2),o)}var v=H(S,8);try{for(v[v.length-1].length<8&&v.pop(),g=0;g<v.length;g++)v[g]=parseInt(v[g],2);n=u+=ot(v)}catch{return console.log("Error!"),null}return n}},$="0123456789abcdef",V="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",P=function(t=0){var r=new X,e=(t<1&&(r.nextBytes(t=[0]),t=t[0]),"0".repeat(t).split(""));return r.nextBytes(e),e.join("").slice(0,t)},it=P,Y=function(t,r){Array.isArray(r)&&(r=r.join("")),t=t.toString(),r=parseInt(r);var e=t.split("").map(t=>(t.charCodeAt(0)+r)%55295).map(t=>{for(;t<0;)t+=55295;return t});return String.fromCharCode(...e)},vt=await import("buffer/index.js"),x=vt.Buffer,lt=2147483647;function z(t){let m=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),S=1779033703,y=3144134277,v=1013904242,d=2773480762,j=1359893119,M=2600822924,b=528734635,C=1541459225,A=new Uint32Array(64);function r(c){let g=0,w=c.length;for(;64<=w;){let t=S,r=y,e=v,n=d,o=j,i=M,s=b,h=C,a,l,f,u,p;for(l=0;l<16;l++)f=g+4*l,A[l]=(255&c[f])<<24|(255&c[f+1])<<16|(255&c[f+2])<<8|255&c[f+3];for(l=16;l<64;l++)a=A[l-2],u=(a>>>17|a<<15)^(a>>>19|a<<13)^a>>>10,a=A[l-15],p=(a>>>7|a<<25)^(a>>>18|a<<14)^a>>>3,A[l]=(u+A[l-7]|0)+(p+A[l-16]|0)|0;for(l=0;l<64;l++)u=(((o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7))+(o&i^~o&s)|0)+(h+(m[l]+A[l]|0)|0)|0,p=((t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10))+(t&r^t&e^r&e)|0,h=s,s=i,i=o,o=n+u|0,n=e,e=r,r=t,t=u+p|0;S=S+t|0,y=y+r|0,v=v+e|0,d=d+n|0,j=j+o|0,M=M+i|0,b=b+s|0,C=C+h|0,g+=64,w-=64}}r(t);let e,n=t.length%64,o=t.length/536870912|0,i=t.length<<3,s=n<56?56:120,h=t.slice(t.length-n,t.length);for(h.push(128),e=1+n;e<s;e++)h.push(0);return h.push(o>>>24&255),h.push(o>>>16&255),h.push(o>>>8&255),h.push(o>>>0&255),h.push(i>>>24&255),h.push(i>>>16&255),h.push(i>>>8&255),h.push(i>>>0&255),r(h),[S>>>24&255,S>>>16&255,S>>>8&255,S>>>0&255,y>>>24&255,y>>>16&255,y>>>8&255,y>>>0&255,v>>>24&255,v>>>16&255,v>>>8&255,v>>>0&255,d>>>24&255,d>>>16&255,d>>>8&255,d>>>0&255,j>>>24&255,j>>>16&255,j>>>8&255,j>>>0&255,M>>>24&255,M>>>16&255,M>>>8&255,M>>>0&255,b>>>24&255,b>>>16&255,b>>>8&255,b>>>0&255,C>>>24&255,C>>>16&255,C>>>8&255,C>>>0&255]}function ft(t,r,e){t=t.length<=64?t:z(t);let n=64+r.length+4,o=new Array(n),i=new Array(64),s,h=[];for(s=0;s<64;s++)o[s]=54;for(s=0;s<t.length;s++)o[s]^=t[s];for(s=0;s<r.length;s++)o[64+s]=r[s];for(s=n-4;s<n;s++)o[s]=0;for(s=0;s<64;s++)i[s]=92;for(s=0;s<t.length;s++)i[s]^=t[s];function a(){for(let t=n-1;t>=n-4;t--){if(o[t]++,o[t]<=255)return;o[t]=0}}for(;32<=e;)a(),h=h.concat(z(i.concat(z(o)))),e-=32;return 0<e&&(a(),h=h.concat(z(i.concat(z(o))).slice(0,e))),h}function ht(t,r,e,n,o){let i;for(O(t,16*(2*e-1),o,0,16),i=0;i<2*e;i++)ct(t,16*i,o,16),Mt(o,n),O(o,0,t,r+16*i,16);for(i=0;i<e;i++)O(t,r+2*i*16,t,16*i,16);for(i=0;i<e;i++)O(t,r+16*(2*i+1),t,16*(i+e),16)}function s(t,r){return t<<r|t>>>32-r}function Mt(t,r){O(t,0,r,0,16);for(let e=8;0<e;e-=2)r[4]^=s(r[0]+r[12],7),r[8]^=s(r[4]+r[0],9),r[12]^=s(r[8]+r[4],13),r[0]^=s(r[12]+r[8],18),r[9]^=s(r[5]+r[1],7),r[13]^=s(r[9]+r[5],9),r[1]^=s(r[13]+r[9],13),r[5]^=s(r[1]+r[13],18),r[14]^=s(r[10]+r[6],7),r[2]^=s(r[14]+r[10],9),r[6]^=s(r[2]+r[14],13),r[10]^=s(r[6]+r[2],18),r[3]^=s(r[15]+r[11],7),r[7]^=s(r[3]+r[15],9),r[11]^=s(r[7]+r[3],13),r[15]^=s(r[11]+r[7],18),r[1]^=s(r[0]+r[3],7),r[2]^=s(r[1]+r[0],9),r[3]^=s(r[2]+r[1],13),r[0]^=s(r[3]+r[2],18),r[6]^=s(r[5]+r[4],7),r[7]^=s(r[6]+r[5],9),r[4]^=s(r[7]+r[6],13),r[5]^=s(r[4]+r[7],18),r[11]^=s(r[10]+r[9],7),r[8]^=s(r[11]+r[10],9),r[9]^=s(r[8]+r[11],13),r[10]^=s(r[9]+r[8],18),r[12]^=s(r[15]+r[14],7),r[13]^=s(r[12]+r[15],9),r[14]^=s(r[13]+r[12],13),r[15]^=s(r[14]+r[13],18);for(let n=0;n<16;++n)t[n]+=r[n]}function ct(t,r,e,n){for(let o=0;o<n;o++)e[o]^=t[r+o]}function O(t,r,e,n,o){for(;o--;)e[n++]=t[r++]}function at(t){if(!t||"number"!=typeof t.length)return!1;for(let e=0;e<t.length;e++){var r=t[e];if("number"!=typeof r||r%1||r<0||256<=r)return!1}return!0}function J(t,r){if("number"!=typeof t||t%1)throw new Error("invalid "+r);return t}var G=function(i,t=it(6),r=29,e=1){let s=Math.pow(2,e),h=Math.pow(8,e),a=Math.pow(4,e),l=r,n={salt:t,cost:s,memory:h,threads:a,octets:l};if(i=x.from(i.normalize("NFKC")),t=x.from(t.normalize("NFKC")),s=J(s,"N"),h=J(h,"r"),a=J(a,"p"),l=J(l,"dkLen"),0===s||s&s-1)throw new Error("N must be power of 2");if(s>lt/128/h)throw new Error("N too large");if(h>lt/128/a)throw new Error("r too large");if(!at(i))throw new Error("password must be an array or buffer");if(i=Array.prototype.slice.call(i),!at(t))throw new Error("salt must be an array or buffer");t=Array.prototype.slice.call(t);let f=ft(i,t,128*a*h),u=new Uint32Array(32*a*h);for(let A=0;A<u.length;A++){var o=4*A;u[A]=(255&f[3+o])<<24|(255&f[2+o])<<16|(255&f[1+o])<<8|(255&f[0+o])<<0}function p(){let n;switch(v){case 0:M=32*d*h,O(u,M,c,0,w),v=1,j=0;case 1:(n=s-j)>b&&(n=b);for(let t=0;t<n;t++)O(c,0,g,(j+t)*w,w),ht(c,w,h,m,S);if(j+=n,y+=n,j<s)break;j=0,v=2;case 2:(n=s-j)>b&&(n=b);for(let r=0;r<n;r++){var o=16*(2*h-1),o=c[o]&s-1;ct(g,o*w,c,w),ht(c,w,h,m,S)}if(j+=n,y+=n,j<s)break;if(O(c,0,u,M,w),++d<a){v=0;break}f=[];for(let e=0;e<u.length;e++)f.push(u[e]>>0&255),f.push(u[e]>>8&255),f.push(u[e]>>16&255),f.push(u[e]>>24&255);return ft(i,f,l)}}let c=new Uint32Array(64*h),g=new Uint32Array(32*h*s),w=32*h,m=new Uint32Array(16),S=new Uint32Array(16),y=(a,s,0),v=0,d=0,j,M,b=4294967295;for(typeof setImmediate<"u"?setImmediate:setTimeout;;){var C=p();if(null!=C)return n.hash=x.from(C).toString("hex"),n}p()},st="";for(let Jb=0;Jb<55295;Jb++)st+=String.fromCharCode(Jb);var Yt=55295..toString().length-1,tt=8,ut=function(t){t=t.toString();var r=K(t,$,10);return K(r,st,11,String.fromCharCode(55295))},Ct=function(t){t=t.toString();var r=pt(t)-t.length;if(0==r)return t;let e="",n=t;for(let i=0;i<r;i++){n=G(t,n,13,1).hash;var o=ut(n);e+=o}return e+t},dt=function(h){if(!((h=h.toString()).length>tt))for(let s=1;s<tt;s++){let t=h.slice(0,s),r=h.slice(s),e=pt(r)-r.length,n="",o=r;for(let i=0;i<e;i++){o=G(r,o,13,1).hash;var a=ut(o);n+=a}if(n==t)return r}return h},pt=function(t){return Math.max(t.length,tt)},At=function(t,r,e=1){e=Math.ceil(e);var n=Math.min(4,e),o=P(64),n=(t=t.toString(),r=r.toString(),r=Ct(r),t=G(t,o,2*r.length*Math.pow(Math.pow(e,e),e),n).hash,H(t,r.length)),i=n[n.length-1].split(""),s=n[n.length-2].split(""),h=n[n.length-3].split(""),a=n[n.length-4].split("");r=r.split("");for(let g=0;g<i.length;g++){var l=Math.ceil(parseInt(i[g],16)/4),f=Math.ceil(parseInt(s[g],16)/4),u=Math.ceil(parseInt(h[g],16)/8),p=Math.ceil(parseInt(a[g],16)/8),c=i[g]+s[g]+h[g]+a[g],c=parseInt(G(t,c,Math.floor((u+p+l+f)/2),1).hash,16);r[g]=Y(r[g],c)}r=r.join("");n=K(r,V,1).replaceAll("=","");return[K(o,V,1).replaceAll("=",""),n].join(":")},It=function(t,r,e=1){e=Math.ceil(e);var n=Math.min(4,e),o=K(r.toString().split(":")[0],V,0),o=(t=t.toString(),r=r.toString().split(":")[1],r=K(r,V,0),t=G(t,o,2*r.length*Math.pow(Math.pow(e,e),e),n).hash,H(t,r.length)),i=o[o.length-1].split(""),s=o[o.length-2].split(""),h=o[o.length-3].split(""),a=o[o.length-4].split("");r=r.split("");for(let g=0;g<i.length;g++){var l=Math.ceil(parseInt(i[g],16)/4),f=Math.ceil(parseInt(s[g],16)/4),u=Math.ceil(parseInt(h[g],16)/8),p=Math.ceil(parseInt(a[g],16)/8),c=i[g]+s[g]+h[g]+a[g],c=parseInt(G(t,c,Math.floor((u+p+l+f)/2),1).hash,16);r[g]=Y(r[g],-c)}return r=r.join(""),dt(r)};export{It as Decrypt,At as Encrypt};